pkgname=apk-tools
pkgver=4.0.0
pkgrel=0
pkgdesc="apk"
makedepends="zlib-dev openssl-dev linux-dev scdoc"
url="https://git.alpinelinux.org/cgit/apk-tools/"
arch="all"
license="GPL2"
source="$pkgname-$pkgver.tar.gz::https://github.com/abyss-os/apk-tools/archive/refs/tags/v$pkgver.tar.gz
        repositories"

build() {
	make CC=$CC LUA=no static
}

check() {
	make CC=$CC LUA=no check
}

package() {
	make CC=$CC LUA=no DESTDIR="$pkgdir" install
#	mkdir -p $pkgdir/usr/bin
#	mv -v $pkgdir/sbin/* $pkgdir/usr/bin/
#	rmdir -v $pkgdir/sbin

	install -Dm755 "$srcdir"/$pkgname-$pkgver/src/apk.static \
		"$pkgdir"/usr/bin/apk

	install -d "$pkgdir"/var/lib/apk \
		"$pkgdir"/var/cache/misc \
		"$pkgdir"/etc/apk/keys \
		"$pkgdir"/etc/apk/protected_paths.d

	install -Dm700 "$srcdir"/repositories \
		"$pkgdir"/etc/apk/repositories

	# the shipped README is empty
	rm -r "$pkgdir"/usr/share/
}

b2sums="e716b92c5b4ee1ce0a8c50077abfec2b18af6545159f2a7bfe4f0b46d7ab0c064b02cf8336e3aadb462d89c1a66732b280f696f257216393e9b20936847ab470  apk-tools-4.0.0.tar.gz
56d6b815a965db900551afebd8b1f7c44fc36fc09bf147599f5c9c31c1377792c732c22793c66ce2ca6470493ebec2e8b32f26044b5ca5c1d1f8a2d7a42929c5  repositories"

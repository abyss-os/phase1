pkgname=ipfs-cluster
pkgver=0.12.1
pkgrel=0
pkgdesc="Inter Platnetary File System (IPFS), a peer-to-peer hypermedia distribution protocol"
url="https://ipfs.io/"
arch="all"
license="MIT Apache-2.0"
options="chmod-clean !check" # No test suite from upstream
depends="go-ipfs"
makedepends="go"
subpackages="$pkgname-doc $pkgname-openrc"
source="$pkgname-$pkgver.tar.gz::https://github.com/ipfs/$pkgname/archive/v$pkgver.tar.gz
	ipfs-cluster-service.initd"

build() {
	export GOPATH="$srcdir"

	go build ./cmd/ipfs-cluster-service
	go build ./cmd/ipfs-cluster-ctl
	go build ./cmd/ipfs-cluster-follow
}

package() {
	for cmd in service ctl follow; do
		install -m755 -D $builddir/${pkgname}-${cmd} \
			"$pkgdir"/usr/bin/${pkgname}-${cmd}
	done

	install -m644 -D -t "$pkgdir/usr/share/doc/$pkgname" README.md

	install -m755 -D "$srcdir"/ipfs-cluster-service.initd \
		"$pkgdir"/etc/init.d/ipfs-cluster-service
}

b2sums="ef69ce9c1ae01cd5a7b76d747f7a48ba614fa053a06d7f26f69fa58b82d3a168f81637ddf67f26054df8528e1feb46343f1a4b7d0f20d5af822e576659df2ba7  ipfs-cluster-0.12.1.tar.gz
e5f21a057daffd083d6d93735b7a98bfda7afa79b883eb64932d1b17f3a14b2cd2134ca31bca5d1bd322f850713d6bda65d9667da1ff82135b34255c6a7a5663  ipfs-cluster-service.initd"

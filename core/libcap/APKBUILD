pkgname=libcap
pkgver=2.33
pkgrel=1
pkgdesc="POSIX 1003.1e capabilities"
options="checkroot"
arch="all"
license="BSD-3-Clause OR GPL-2.0-only"
url="http://www.friedhoff.org/posixfilecaps.html"
makedepends="linux-dev perl attr-dev"
checkdepends="bash"
options="!check"
source="https://kernel.org/pub/linux/libs/security/linux-privs/libcap2/libcap-$pkgver.tar.xz
		pthread.patch"
subpackages="$pkgname-doc $pkgname-dev"
builddir="$srcdir"/$pkgname-$pkgver

build() {
	cd "$builddir"
	make BUILD_CC=$CC CC=$CC CFLAGS="$CFLAGS" LDFLAGS="$LDFLAGS" lib=lib prefix=/usr DESTDIR="$pkgdir" GOLANG=no
}

check() {
	cd "$builddir"
	# Running make test runs the command below but with sudo
	cd progs && ./quicktest.sh
}

package() {
	cd "$builddir"
	make lib=lib prefix=/usr RAISE_SETFCAP=no DESTDIR="$pkgdir" GOLANG=no install
	# Fix perms
	chmod -v 0755 "$pkgdir"/usr/lib/libcap.so.${pkgver}
	# move
	mv -v ${pkgdir}/usr/sbin ${pkgdir}/usr/bin
}

b2sums="9a34b6e871c6175da5ef665ab7a5ed8b9889f598875f58a6e0b7aef9b6b2737f2a85bb0a6e259a730a3fcea3b8ebbec793b52ee5dec7d11fcf236dfb2148eb83  libcap-2.33.tar.xz
243fdfbde6cd14697511ffc5032d990cc06cd64cbfce69aa9831e511ddc1e677c26500bee30eafddd47df8188c1eed815bdb2777830727abbfdfbba7226ee32e  pthread.patch"

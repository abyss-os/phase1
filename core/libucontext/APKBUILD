pkgname=libucontext
pkgver=0.11
pkgrel=0
pkgdesc="ucontext function implementations"
url="https://github.com/kaniini/libucontext"
arch="all"
license="ISC"
subpackages="$pkgname-dev"
source="https://distfiles.dereferenced.org/libucontext/libucontext-$pkgver.tar.xz"
options="!check" # segfault on mips, but seems to work fine

case "$CTARGET_ARCH" in
	arm*)		LIBUCONTEXT_ARCH="arm" ;;
	ppc64*)		LIBUCONTEXT_ARCH="ppc64" ;;
	*)		LIBUCONTEXT_ARCH="$CTARGET_ARCH" ;;
esac

build() {
	make ARCH="$LIBUCONTEXT_ARCH"
}

check() {
	make ARCH="$LIBUCONTEXT_ARCH" check
}

package() {
	make ARCH="$LIBUCONTEXT_ARCH" DESTDIR="$pkgdir" install
	mkdir -p $pkgdir/usr && mv $pkgdir/lib $pkgdir/usr/
}

b2sums="300ec96902653e2af7b12f3110231232442f466bcf7c9986905df2e2d42a3b59214e6ec74fd9c0ea59fc3b6ca9cea20075c9f855ee40b6f0e557e4e5f47f7a32  libucontext-0.11.tar.xz"

pkgname=zerotier-one
pkgver=1.6.5
pkgrel=0
pkgdesc="ZeroTier One allows systems to join and participate in ZeroTier virtual networks."
url="https://www.zerotier.com/"
arch="all"
license="GPL-3.0-or-later"
makedepends="linux-dev binutils"
subpackages="$pkgname-doc $pkgname-openrc"
source="$pkgname-$pkgver.tar.gz::https://github.com/zerotier/ZeroTierOne/archive/$pkgver.tar.gz
	zerotier-one.initd"
builddir="$srcdir"/ZeroTierOne-$pkgver

build() {
    make AS=gnu-as
}

check() {
	make selftest
}

package() {
	make DESTDIR="$pkgdir" install
	mv "$pkgdir"/usr/sbin "$pkgdir"/usr/bin
	install -m755 -D "$srcdir"/$pkgname.initd \
		"$pkgdir"/etc/init.d/$pkgname
}

b2sums="72c207b1ca27745b836bd7db688cf0492e7a643688eac844f4820abe2694859ac567971071f920e4dfc3666f9582d86f3fdccf99c9c8cde9e04e6eee2a372d23  zerotier-one-1.6.5.tar.gz
09f1149b6f620c3337d85f389e3e11774d094c61c38ed0a11e4a4f7cc63e5931274f6afad3bc9d7d3b0e73b474d6e2c141fbf898e007385cebfd34bba89ee21b  zerotier-one.initd"

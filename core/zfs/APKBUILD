pkgname=zfs
pkgver=2.0.5
pkgrel=0
pkgdesc="ZFS for Linux"
url="https://zfsonlinux.org"
arch="all"
license="CDDL-1.0"
depends_dev="attr-dev e2fsprogs-dev glib-dev libtirpc-dev openssl-dev util-linux-dev"
makedepends="$depends_dev automake autoconf libtool linux-dev"
# later: python3-dev py-cffi py-setuptools
options="!check"
subpackages="$pkgname-dev $pkgname-doc $pkgname-openrc"
source="https://github.com/zfsonlinux/zfs/releases/download/zfs-$pkgver/zfs-$pkgver.tar.gz"

build() {
	./configure --prefix=/usr \
		--with-tirpc \
        --bindir=/usr/bin \
        --sbindir=/usr/bin \
        --libdir=/usr/lib \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--infodir=/usr/share/info \
		--localstatedir=/var \
		--with-config=user \
		--with-udevdir=/usr/lib/udev \
		--disable-systemd \
		--with-python=3

#	later:	--enable-pyzfs
	make -j${JOBS}
}

package() {
	make DESTDIR="$pkgdir" install
	rm -rf $pkgdir/usr/share/initramfs-tools $pkgdir/usr/share/tests
    mv -v $pkgdir/sbin/* $pkgdir/usr/bin/
    rmdir $pkgdir/sbin
}

b2sums="4505c43a3b9a6c2b925383d00bbd9f17505290ded83f9bd3f08211769fa39254742340bdda65efd53f87f1708138517f91f8a43c01f3ce4191de200c84c77754  zfs-2.0.5.tar.gz"

pkgname=nim
pkgver=1.4.8
pkgrel=1
pkgdesc="A systems and applications programming language"
url="https://nim-lang.org/"
arch="all"
license="MIT"
depends="pcre"
makedepends="nim-bootstrap nim-dev libucontext-dev"
source="https://nim-lang.org/download/$pkgname-$pkgver.tar.xz"
builddir="$srcdir/$pkgname-$pkgver"
provides="nim-bootstrap=$pkgver-r$pkgel"

build() {
	msg koch
	nim compile -d:release koch
	msg boot
	./koch boot -d:release
	msg tools
	./koch tools -d:release
}

package() {
	mkdir -p $pkgdir/usr/bin
	DESTDIR="$pkgdir" ./koch install /usr/bin
	rm -rf $pkgdir/usr/share/doc
	install -D -m755 tools/niminst/niminst $pkgdir/usr/bin/
	for t in nim-gdb nim-gdb.bash nimble nimfind nimgrep nimpretty nimsuggest testament; do
		install -D -m755 bin/$t $pkgdir/usr/bin/
	done

}

b2sums="961b38275c4f9de87ac522c5b47368ce7f5543811a2dfd7b4f3fd79a104bcd0458caaaaab1705f99eb42c64735ca5f71d5018f8a8275a430d883233b28b1d412  nim-1.4.8.tar.xz"

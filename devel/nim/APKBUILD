pkgname=nim
pkgver=1.6.0
pkgrel=0
pkgdesc="A systems and applications programming language"
url="https://nim-lang.org/"
arch="all"
license="MIT"
depends="pcre"
makedepends="nim-bootstrap libucontext-dev"
source="https://nim-lang.org/download/$pkgname-$pkgver.tar.xz"
provides="nim-bootstrap=$pkgver-r$pkgel"

build() {
    msg csources
    ./build.sh
	msg koch
	./bin/nim compile -d:release koch
	msg boot
	./koch boot -d:release
	msg tools
	./koch tools -d:release
}

package() {
	mkdir -p $pkgdir/usr/bin
	DESTDIR="$pkgdir" ./koch install /usr/bin
	rm -rf $pkgdir/usr/share/doc
	install -D -m755 tools/niminst/niminst $pkgdir/usr/bin/
	for t in atlas nim-gdb nimble nimgrep nimpretty nimsuggest testament; do
		install -D -m755 bin/$t $pkgdir/usr/bin/
	done

}

b2sums="2381108ee0661c2106c044cfc119bda4ea1c8eb2a642327bb29f3e23f16a4712ae1479913369ff3b62a073fa5f40b725259404acc21efb32d33cf9291f20e25b  nim-1.6.0.tar.xz"

pkgname=nodejs
pkgver=16.9.1
pkgrel=0
pkgdesc="JavaScript runtime built on V8 engine"
url="https://nodejs.org/"
arch="all !riscv64"
license="MIT"
depends="ca-certificates"
makedepends="linux-dev python3 libuv-dev c-ares-dev nghttp2-dev openssl-dev icu-dev brotli-dev libatomic-dev samurai"
subpackages="$pkgname-dev $pkgname-doc"
source="https://nodejs.org/dist/v$pkgver/node-v$pkgver.tar.gz"
builddir="$srcdir/node-v$pkgver"

build() {
	case "$CARCH" in
		mips64) _carchflags="--with-mips-float-abi=soft";;
	esac

	./configure --prefix=/usr \
		--shared-brotli \
		--shared-zlib \
		--shared-libuv \
		--shared-cares \
		--shared-nghttp2 \
		--shared-openssl \
		--openssl-use-def-ca-store \
		--with-intl=system-icu \
		--ninja \
        $_carchflags \

	make BUILDTYPE=Release -j${JOBS}
}

package() {
	make DESTDIR="$pkgdir" BUILDTYPE=Release install
}

b2sums="0c5725d7d1bbb6c6b237f03f5860f7a8a8ef4b589eb155c09c13a5e7d5e0dd577e8834f6640e2b7ad51883f26f18d7358794d3c9d56871e7cd6ff3c2d799138d  node-v16.9.1.tar.gz"

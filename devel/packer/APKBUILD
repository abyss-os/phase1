pkgname=packer
pkgver=1.7.4
pkgrel=0
pkgdesc="Build Automated Machine Images"
url="https://www.packer.io/"
arch="all"
license="MPL-2.0"
makedepends="go"
source="$pkgname-$pkgver.tar.gz::https://github.com/hashicorp/packer/archive/v$pkgver.tar.gz"

build() {
    #go mod vendor
    go build -v -o bin/$pkgname -ldflags "-X main.GitCommit=v$pkgver -X github.com/hashicorp/packer/version.Prerelease= -s -w" -mod=readonly
}

check() {
	GOPATH="$srcdir" go list -mod=vendor . | xargs -t -n4 go test -mod=vendor -timeout=2m -parallel=4
	bin/$pkgname -v
}

package() {
	install -Dm755 "$builddir"/bin/$pkgname "$pkgdir"/usr/bin/$pkgname
}

b2sums="090bf731f8723d6fddedf142c14048deabd40d94aa356e71bd727b81a7913e772fe03ac73de8666904745313ec2692753f31cb52e2270a05a1c7e2fc8189bc12  packer-1.7.4.tar.gz"
